<!DOCTYPE html>
<html>
<head>
  <title>{% block title %}School ERP{% endblock %}</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

  <style>
    body { font-family: 'Segoe UI', sans-serif; }

    .hero {
      background: linear-gradient(135deg, #0d6efd, #0b5ed7);
      color: white;
      border-radius: 16px;
      padding: 60px;
    }

    .hero h1 span { color: #ffd43b; }

    .feature-card {
      border-radius: 14px;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .feature-card:hover {
      transform: translateY(-8px);
      box-shadow: 0 10px 30px rgba(0,0,0,0.15);
    }

    .icon-circle {
      width: 55px;
      height: 55px;
      border-radius: 50%;
      background: #0d6efd;
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 22px;
      margin: auto;
    }

    .cta-box {
      background: linear-gradient(135deg, #198754, #157347);
      border-radius: 16px;
    }
  </style>
</head>

<body class="bg-light">

<nav class="navbar navbar-expand-lg navbar-dark bg-primary mb-3">
  <div class="container">

    <a class="navbar-brand" href="/">School ERP</a>

    {% if user.is_authenticated %}
      {% with user.groups.all|first as group %}
      <div class="ms-auto d-flex gap-2">

        {# üëë ADMIN ‚Äì ALL ACCESS #}
        {% if user.is_superuser %}
          <a class="btn btn-sm btn-outline-light" href="/attendance/class-wise/">Attendance</a>
          <a class="btn btn-sm btn-outline-light" href="/fees/">Fees</a>
          <a class="btn btn-sm btn-outline-light" href="/admin/">Admin</a>
        {% endif %}

        {# üë©‚Äçüè´ TEACHER ‚Äì ATTENDANCE ONLY #}
        {% if group and group.name == "Teacher" %}
          <a class="btn btn-sm btn-outline-light" href="/attendance/class-wise/">Class-wise</a>
          <a class="btn btn-sm btn-outline-light" href="/attendance/percentage/">Percentages</a>
          <a class="btn btn-sm btn-outline-light" href="/attendance/summary/">Today</a>
        {% endif %}

        {# üë®‚Äçüíº ACCOUNTANT ‚Äì FEES ONLY #}
        {% if group and group.name == "Accountant" %}
          <a class="btn btn-sm btn-outline-light" href="/fees/">Fees</a>
        {% endif %}

        <a class="btn btn-sm btn-light ms-2" href="/logout/">Logout</a>

      </div>
      {% endwith %}
    {% else %}
      <div class="ms-auto">
        <a class="btn btn-sm btn-light" href="/login/">Login</a>
      </div>
    {% endif %}

  </div>
</nav>

{% if messages %}
<div class="container mb-3">
  {% for message in messages %}
    <div class="alert alert-success alert-dismissible fade show">
      {{ message }}
      <button class="btn-close" data-bs-dismiss="alert"></button>
    </div>
  {% endfor %}
</div>
{% endif %}

<div class="container my-4">
  {% block content %}{% endblock %}
</div>

<!-- üîî LEAD POPUP MODAL -->
<div class="modal fade" id="leadModal" tabindex="-1">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header bg-primary text-white">
        <h5 class="modal-title">Get Started Today</h5>
        <button class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
      </div>

      <form method="post" action="/lead/">
        {% csrf_token %}
        <input type="hidden" name="source" id="leadSource" value="Popup">

        <div class="modal-body">
          <div class="row g-3">
            <div class="col-md-6"><input class="form-control" name="name" placeholder="Your Name" required></div>
            <div class="col-md-6"><input class="form-control" name="email" placeholder="Email"></div>
            <div class="col-md-6"><input class="form-control" name="phone" placeholder="Contact Number" required></div>
            <div class="col-md-6"><input class="form-control" name="institute" placeholder="School / Institute Name"></div>
            <div class="col-md-6"><input class="form-control" name="role" placeholder="Your Role"></div>
            <div class="col-md-6"><input class="form-control" name="city" placeholder="City"></div>
          </div>
        </div>

        <div class="modal-footer">
          <button class="btn btn-primary w-100">Get a Free Demo</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

<!-- üéØ SOURCE TRACKING -->
<script>
document.querySelectorAll('[data-bs-target="#leadModal"]').forEach(btn => {
  btn.addEventListener("click", function () {
    const source = btn.getAttribute("data-source") || "Home";
    const input = document.getElementById("leadSource");
    if (input) input.value = source;
  });
});
</script>

<!-- üöÄ POPUP LOGIC -->
<script>
document.addEventListener("DOMContentLoaded", function () {

  let popupShown = localStorage.getItem("lead_popup_shown");

  function showPopup() {
    if (popupShown) return;

    const modalEl = document.getElementById("leadModal");
    if (!modalEl || typeof bootstrap === "undefined") return;

    const modal = new bootstrap.Modal(modalEl);
    modal.show();

    localStorage.setItem("lead_popup_shown", "yes");
    popupShown = true;
  }

  // ‚è± 5 sec delay AFTER page + bootstrap ready
  setTimeout(showPopup, 5000);

  // üñ± Exit intent
  document.addEventListener("mouseleave", function (e) {
    if (e.clientY <= 0) showPopup();
  });

});
</script>

</body>
</html>
